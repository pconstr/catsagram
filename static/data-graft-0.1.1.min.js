/* Copyright 2010-2011, Carlos Guerreiro
 * Licensed under the MIT license */data_graft=function(){function F(){return{lastTestResult:b}}function E(a,b,c){var d=function(){s(a),n(a,b,"postRemoveElse",c.dec)};c.inc(),n(a,b,"preRemoveElse",d)}function D(a,b,c){var d=function(){s(a),n(a,b,"postRemoveIf",c.dec)};c.inc(),n(a,b,"preRemoveIf",d)}function C(a,b,c,d){var e=function(){a.parentNode.replaceChild(b,a),n(b,c,"postInsertElse",d.dec)};d.inc(),n(a,c,"preInsertElse",e)}function B(a,b,c,d){var e=function(){a.parentNode.replaceChild(b,a),n(b,c,"postInsertIf",d.dec)};d.inc(),n(a,c,"preInsertIf",e)}function A(a,c,d,e,f){var g=a.getAttribute(c),h=g!==null,i=d!==b&&d!==null,j;h?i?g!==d&&(j=function(){a.setAttribute(c,d),n(a,e,"postUpdateAttribute",f.dec,c)},f.inc(),n(a,e,"preUpdateAttribute",j,c)):(j=function(){a.removeAttribute(c),n(a,e,"postRemoveAttribute",f.dec,c)},f.inc(),n(a,e,"preRemoveAttribute",j,c)):i&&(j=function(){a.setAttribute(c,d),n(a,e,"postAddAttribute",f.dec,c)},f.inc(),n(a,e,"preAddAttribute",j,c))}function z(a,c,d,e){var f=c!==null&&c!==b,g=a.childNodes.length>0,h;f?g?a.childNodes[0].nodeValue!==c&&(h=function(){a.childNodes[0].nodeValue=c,n(a,d,"postUpdateText",e.dec)},e.inc(),n(a,d,"preUpdateText",h)):(h=function(){a.appendChild(document.createTextNode(c)),n(a,d,"postInsertText",e.dec)},e.inc(),n(a,d,"preInsertText",h)):g&&(h=function(){a.removeChild(a.childNodes[0]),n(a,d,"postRemoveText",e.dec)},e.inc(),n(a,d,"preRemoveText",h))}function y(a,b,c){var d=function(){a.parentNode.removeChild(a),c.dec()};c.inc(),n(a,b,"preRemoveSequence",d)}function x(a,b,c,d){var e=function(){a.appendChild(b),n(b,c,"postInsertSequence",d.dec)};d.inc(),n(b,c,"preInsertSequence",e)}function w(a,b,c,d){var e=function(){a.parentNode.insertBefore(b,a),n(b,c,"postInsertSequence",d.dec)};d.inc(),n(b,c,"preInsertSequence",e)}function v(c,d,e,f,h,j,k){var l={},n=m(e,d,l),s=null,t=n.templateVariable;t&&(s=document.getElementById(t));var v=null,w,x;if(e.attributes!==null)for(i=0;i<e.attributes.length;++i)a=e.attributes[i],a.name.slice(0,11)==="data-graft-"&&a.name.slice(0,12)==="data-graft--"&&(an=a.name.slice(12),w=g(d,a.value,h,j),c.getAttribute(an)!==w&&A(c,an,w,j,k));if(e.tagName!==b){var y,F,G;o(h,l),n.ifVariable!==b?(w=g(d,n.ifVariable,h,j),y=w!==null&&w!==b,F=c.childNodes.length>0,y?F?r(c.childNodes[0],w,s!==null?s.childNodes[0]:e.childNodes[0],f,h,j,k):(v=q(d,e,b,f,h,j),B(c,v,j,k)):F&&D(c,j,k),f.lastTestResult=y):n.elseVariable!==b?(y=!f.lastTestResult,F=c.childNodes.length>0,y?F?r(c.childNodes[0],d,e.childNodes[0],f,h,j,k):(v=q(d,e,b,f,h,j),C(c,v,j,k)):F&&E(c,j,k)):n.textVariable!==b?(x=g(d,n.textVariable,h,j),z(c,x,j,k)):n.elementVariable!==b?(G=g(d,n.elementVariable,h,j),c.replaceChild(G,c.childNodes[0])):n.eachVariable!==b?f.lastTestResult=u(c,d,e.childNodes[0],f,h,b,n.eachVariable,j,k):n.forVariable!==b?f.lastTestResult=u(c,d,e.childNodes[0],f,h,n.forVariable,b,j,k):c.childNodes.length>0&&e.childNodes.length>0&&r(c.childNodes[0],d,e.childNodes[0],f,h,j,k),p(h,l)}}function u(a,c,d,e,f,g,h,i,j){function m(){while(n!==null&&n.nodeType===3)n=n.nextSibling}var n;a.childNodes.length>0?n=a.childNodes[0]:n=null;var o=d;while(o!==null&&o.nodeType===3)o=o.nextSibling;var p,r,s,u,z,A;m();var B;g!==b?B=l(c,g,f,i):B=k(c);var C=0,D;while(C<B.length&&n!==null)r=t(n),g!==b?(D=B[C][0],keyi=B[C][1]):(D=B[C],keyi=D),r<D?(z=n,n=n.nextSibling,y(z,i,j),m()):r>D?(h!==b&&(f[h]=D),A=q(c[keyi],o,D,e,f,i),h!==b&&delete f[h],w(n,A,i,j),++C):(h!==b&&(f[h]=D),v(n,c[keyi],o,e,f,i,j),h!==b&&delete f[h],++C,n=n.nextSibling,m());while(C<B.length)g!==b?(D=B[C][0],keyi=B[C][1]):(D=B[C],keyi=D),h!==b&&(f[h]=D),A=q(c[keyi],o,D,e,f,i),x(a,A,i,j),h!==b&&delete f[h],++C;while(n!==null)z=n,n=n.nextSibling,y(z,i,j),m();return B.length>0}function t(a){var b=null,c,d;for(d=0;d<a.attributes.length;++d)c=a.attributes[d],c.name==="data-graft-idx"&&(b=c.value);return b}function s(a){var b,c=a.firstChild;while(c!==null)b=c,c=c.nextSibling,a.removeChild(b)}function r(a,b,c,d,e,f,g){while(c!==null&&a!==null)v(a,b,c,d,e,f,g),a=a.nextSibling,c=c.nextSibling}function q(a,c,d,e,f,h){function r(a,b,c){var d,g;o(f,z);for(d=0;d<c.childNodes.length;++d)g=c.childNodes[d],A.appendChild(q(b,g,a,e,f,h));p(f,z)}function j(a,b){var d,g;o(f,z);for(d=0;d<c.childNodes.length;++d){g=c.childNodes[d];if(g.nodeType===1){A.appendChild(q(b,g,a,e,f,h));break}}p(f,z)}function i(){var d,g;o(f,z);for(d=0;d<c.childNodes.length;++d)g=c.childNodes[d],A.appendChild(q(a,g,b,e,f,h));p(f,z)}var s,t,u,v,w,x,y,z={},A=null,B=m(c,a,z),C=null,D=B.templateVariable;D!==b&&(C=document.getElementById(D)),c.tagName!==b&&(A=document.createElement(c.tagName),d!==b&&A.setAttribute("data-graft-idx",d));if(c.attributes!==null)for(s=0;s<c.attributes.length;++s)u=c.attributes[s],u.name.slice(0,11)==="data-graft-"?u.name.slice(0,12)==="data-graft--"&&(v=u.name.slice(12),w=g(a,u.value,f,h),w!==b&&w!==null&&A.setAttribute(v,w)):u.name!=="id"&&u.value!==b&&A.setAttribute(u.name,u.value);c.nodeType===3&&(A=document.createTextNode(c.nodeValue)),c.nodeType===8&&(A=document.createComment(c.nodeValue));var E,F,G;if(B.forVariable!==b){G=l(a,B.forVariable,f,h),testResult=G.length>0;for(s=0;s<G.length;++s)j(G[s][0],a[G[s][1]]);e.lastTestResult=testResult}else if(B.eachVariable!==b){G=k(a),testResult=G.length>0;for(s=0;s<G.length;++s)z[B.eachVariable]=G[s],j(G[s],a[G[s]]);e.lastTestResult=testResult}else B.ifVariable!==b?(w=g(a,B.ifVariable,f,h),testResult=w!==null&&w!==b,testResult&&r(b,w,C!==null?C:c),e.lastTestResult=testResult):B.elseVariable!==b?e.lastTestResult||i():B.textVariable!==b?(y=g(a,B.textVariable,f,h),y!==null&&y!==b&&A.appendChild(document.createTextNode(g(a,B.textVariable,f,h)))):B.elementVariable!==b?A.appendChild(g(a,B.elementVariable,f,h)):i();A!==null&&c.nodeType===1&&n(A,h,"init",b,a,f);return A}function p(a,b){var c;for(c in b)b.hasOwnProperty(c)&&delete a[c]}function o(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function n(a,c,d,e,f){function i(){var j,k;if(h===g.length)e!==b&&e();else{j=g[h],h=h+1,k=c[j];if(k!==b&&k[d]!==b){k[d](a,i,f);return}i()}}var g=a.className.split(" ");g.push("_all_");var h=0;i()}function m(a,c,d){var e={},f,g,h,i,j,k;if(a.attributes!==null)for(f=0;f<a.attributes.length;++f)g=a.attributes[f],g.name==="data-graft-each"?e.eachVariable=g.value:g.name==="data-graft-for"?e.forVariable=g.value:g.name==="data-graft-if"?e.ifVariable=g.value:g.name==="data-graft-else"?e.elseVariable=g.value:g.name==="data-graft-template"?e.templateVariable=g.value:g.name==="data-graft-element"?e.elementVariable=g.value:g.name==="data-graft-text"?e.textVariable=g.value:g.name==="data-graft-push"&&(i=g.value.split("="),j=i[0],i.length>=2?k=i[1]:k=i[0],h=c[k],h!==b&&(d[j]=h));return e}function l(a,b,c,d){var e=[],f;for(f=0;f<a.length;++f)c._idx_=f,e.push([g(a[f],b,c,d),f]),delete c._idx_;e.sort(function(a,b){return a[0]-b[0]});return e}function k(a){var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(c);b.sort();return b}function j(a){var c;if(a===b||a===null)return!0;if(typeof a=="object"){if(a.constructor===Array&&a.length===0)return!0;for(c in a)if(a.hasOwnProperty(c))return!1;return!0}return!1}function h(a){var b;for(b in a)if(a.hasOwnProperty(b))return!1;return!0}function g(a,e,g,h){var i,j,k,l,m;if(e[0]===":"){i=e.slice(1),l=d(i,h);return c(l(f(a,g)))}if(e==="")return c(a);k=d(e,g);if(k!==b)return c(k);if(typeof a=="object"||typeof a=="string"){k=d(e,a);if(k!==b)return c(k)}return b}function f(a,b){var c=typeof a;if(c!=="object")return a;if(h(b))return a;var d=e(a),f;for(f in b)b.hasOwnProperty(f)&&(d[f]=b[f]);return d}function e(a){function b(){}b.prototype=a;return new b}function d(a,c){var d=a.split("."),e;for(e=0;e<d.length;++e){c=c[d[e]];if(c===b)return c}return c}function c(a){return typeof a=="number"?String(a):a}var b,G={update:function(a){var c=this.context,d=0,e=!1,f=F(),g={inc:function(){d=d+1},dec:function(){d=d-1,d===0&&e&&c.finish!==b&&c.finish()}};c.start!==b&&c.start(),v(this.output,a,this.template,f,{},c,g),e=!0,c.finish!==b&&d===0&&c.finish()}};return{germ:function(a,c,d){var f=e(G),g=F();f.context=d,f.template=c,f.output=q(a,c,b,g,{},d);return f}}}()